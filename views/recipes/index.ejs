<%- include ../partials/header.ejs %> 



<div id="allRecipesContainer" class="pageContainer">
    <% recipes.forEach(function(r) { %>
        <% if (r.deletedAt == null) {%>
            <% var recipeAuthorId = r.userId %>
            <% var recipeAuthor = users.filter(obj => { return obj._id == recipeAuthorId }) %>
            <% var recipeAuthorName = recipeAuthor[0].name %>

            <% var favorited = favorites.filter(obj => { return obj.recipeId == r._id }) %>
            <% var favoritedCount = favorited.length %>

            <div class="recipeContainer mb10">
                <div class="recipePhoto">
                    <a class="noDecoration" href="/recipes/<%= r._id %>"><img class="thumbnail mr10 thumb300" src="<%= r.imageUrl %>"></a>
                </div>
                <div class="recipeName">
                    <h2><a class="noDecoration" href="/recipes/<%= r._id %>"><%= r.name %></a><h2>
                </div>
                <div class="recipeAuthor">
                    <a class="noDecoration" href="/users/">By <%= recipeAuthorName %></a>
                </div>
                <div class="recipeStats">
                    <div class="recipeRating">
                    <% if (r.rating > 0) { %>
                        <span class="userRating mr10"> <%= "★".repeat(r.rating) %></span> <span class="ml5">(<%= r.ratingCount %>)</span>
                    <% } else { %>
                        <span class="userRating mr10"> <%= "☆".repeat(5) %></span> <span class="ml5">(<%= 0 %>)</span>
                    <% } %>
                    <span class="ml5 mr5"> | </span>
                    </div>
                    <div class="recipeFavorited">
                        <img class="thumb15 mr10" src="../images/icon_heart.svg">(<%= favoritedCount %>)
                    </div>
                </div>
                <div class="recipeDescription">
                    <a class="noDecoration" href="/recipes/<%= r._id %>"><%= r.description %></a>
                </div>
            </div>
        <% } %>
    <% }); %>
</div>


